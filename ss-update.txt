#!/bin/bash

####################################################################################################
#### author: SlickStack ############################################################################
#### link: https://slickstack.io ###################################################################
#### mirror: http://mirrors.slickstack.io/ss-update.txt ############################################
#### path: /var/www/ss-update ######################################################################
#### destination: n/a (not a boilerplate) ##########################################################
#### purpose: updates all SlickStack modules (only) via the latest Ubuntu packages #################
#### ss version: SlickStack alpha ss5a #############################################################
#### module version: n/a ###########################################################################
####################################################################################################

## YOU CAN SAFELY RUN THIS SCRIPT WITH NO EFFECT TO SLICKSTACK CONFIGURATION ##

## include SlickStack configuration ##
source /var/www/ss-config

####################################################################################################
#### update + upgrade + autoremove + autoclean all Ubuntu packages #################################
####################################################################################################

## update repo cache ##
DEBIAN_FRONTEND=noninteractive DEBIAN_PRIORITY=critical PATH='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin' /usr/bin/apt -q --yes -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" update

## upgrade all installed packages ##
DEBIAN_FRONTEND=noninteractive DEBIAN_PRIORITY=critical PATH='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin' /usr/bin/apt -q --yes -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" upgrade

## autoremove packages ##
DEBIAN_FRONTEND=noninteractive DEBIAN_PRIORITY=critical PATH='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin' /usr/bin/apt -q --yes -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" autoremove

## autoclean packages ##
DEBIAN_FRONTEND=noninteractive DEBIAN_PRIORITY=critical PATH='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin' /usr/bin/apt -q --yes -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" autoclean

####################################################################################################
#### restart services and confirm script has finished running ######################################
####################################################################################################

## restart services ##
/etc/init.d/nginx restart
/etc/init.d/php7.2-fpm restart
/etc/init.d/redis-server restart
/etc/init.d/ufw force-reload
/etc/init.d/ufw restart
# /etc/init.d/mysql restart
# /etc/init.d/monit restart

## message alert ##
echo -e "\e[36mSlickStack modules (Ubuntu packages) update/upgrade complete! Please reboot server.\e[0m"

####################################################################################################
#### reboot server (optional setting in ss-config for automatic monthly updates) ###################
####################################################################################################

## BETTER TO RUN THIS SCRIPT MANUALLY AND REBOOT MANUALLY ##
# awaiting better reboot snippet here
